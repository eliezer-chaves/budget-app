<div class="container mt-4">
  <h4 *ngIf="user(); else loading">Bem-vindo, {{user()?.full_name}}</h4>
  <ng-template #loading>
    <p>Carregando dados do usuário...</p>
  </ng-template>
</div>
<div class="container">
  <button nz-button nzType="primary" (click)="showModal()">Nova Compra</button>

</div>
<div class="container mt-4">
  <h5>Dados das ultimas compras</h5>
</div>
<div class="container mt-4 d-flex justify-content-around">
  <div class="card shadow p-3 d-flex align-items-center justify-content-center">
    <b>Total Gasto</b>
    <span *ngIf="totalGasto > 0 ; else templateSemCompra">{{totalGasto |
      currency:'BRL':'symbol':'1.2-2':'pt-BR'}}</span>
  </div>

  <div class="card shadow p-3 d-flex align-items-center justify-content-center">
    <b>Compras Finalizadas</b>
    <span *ngIf="comprasRealizadas != 0 ; else templateSemCompra">{{comprasRealizadas}}</span>
  </div>
  <div class="card shadow p-3 d-flex align-items-center justify-content-center">
    <b>Compras em Aberto</b>
    <span *ngIf="comprasEmAberto != 0 ; else templateSemCompraAberta">{{comprasEmAberto}}</span>
  </div>
  <ng-template #templateSemCompra>
    Nenhuma Compra
  </ng-template>
  <ng-template #templateSemCompraAberta>
    Nenhuma Compra em Aberto
  </ng-template>
</div>

<div class="container mt-4">
    <app-search-table ></app-search-table>
</div>

<!--Modal-->
<nz-modal [(nzVisible)]="isVisible" [nzTitle]="modalTitle" [nzContent]="modalContent" [nzFooter]="modalFooter"
  (nzOnCancel)="handleCancel()">
  <ng-template #modalTitle>Nova Compra</ng-template>

  <ng-template #modalContent>

    <nz-input-group nzAddOnBefore="Data da Compra" class="w-100">
      <nz-date-picker [(ngModel)]="dataCompra" class="w-100" (ngModelChange)="onChange($event)"
        nzFormat="dd/MM/yyyy"></nz-date-picker>
    </nz-input-group>

    <nz-form-control [nzErrorTip]="'O nome do mercado é obrigatório'">
      <nz-input-group nzAddOnBefore="Local" class="mt-2 ">
        <input type="text" nz-input placeholder="Ex: Supermercado" [(ngModel)]="mercadoNome" name="mercadoNome" required
          #mercadoInput="ngModel" />
      </nz-input-group>
    </nz-form-control>

    <nz-input-group nzAddOnBefore="Quantidade de Categorias" class="mt-2">
      <nz-input-number [(ngModel)]="qtdCarrinhos" nzMin="1" class="w-100" (ngModelChange)="onQtdCarrinhosChange($event)"
        value=1 />
    </nz-input-group>

    <div *ngFor="let name of carrinhosNames; let i = index; trackBy: trackByFn">
      <nz-input-group [nzAddOnBefore]="'Categoria'" class="mt-2">
        <input #inputEl type="text" nz-input placeholder="Ex: Alimentação" [(ngModel)]="carrinhosNames[i]"
          (keydown)="onKeyDown($event, i)" />
      </nz-input-group>
    </div>
  </ng-template>

  <ng-template #modalFooter>
    <button nz-button nzType="default" (click)="handleCancel()">Cancelar</button>
    <button nz-button nzType="primary" (click)="handleOk()" [nzLoading]="isConfirmLoading">Avançar</button>
  </ng-template>
</nz-modal>